<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.OrderItemMapper">
    <resultMap id="_OrderItemBean" type="OrderItem">
        <id column="id" property="id"/>
        <id column="number" property="number"/>
        <association property="product" javaType="Product"  select="mapper.ProductMapper.getById" column="pid"/>
    </resultMap>
    <insert id="add" parameterType="OrderItem" useGeneratedKeys="true" keyProperty="id">
        insert into order_item_ (id, oid, pid, number) value (null, #{order.id},#{product.id},#{number})
    </insert>
    <!--注意这里可以通过OrderItem ID来删除OrderItem的前提.-->
    <!--<delete id="deleteOrderItemById" parameterType="_int">-->
        <!--delete from order_item_ where id = #{id}-->
    <!--</delete>-->
    <!--要删除就要删除所有相同的OrderItem-->
    <delete id="delete" parameterType="OrderItem">
        delete from order_item_ where pid = #{product.id} and oid = #{order.id}
    </delete>
    <!--多对多关系没有更新操作-->
    <!--<update id="updateOrderItem" parameterType="OrderItem">-->
        <!--update order_item_ set oid = #{order.id}, pid = #{product.id}, number = #{number} where id = #{id}-->
    <!--</update>-->
    <select id="_getByOrderId" parameterType="_int" resultMap="_OrderItemBean">
        select * from order_item_ where oid=#{oid}
    </select>

</mapper>